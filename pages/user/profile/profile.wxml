<view class="profile-page {{lang === 'ug' ? 'rtl' : ''}}">
  <!-- 会员卡片 -->
  <view class="vip-card {{isVip ? 'vip-active' : 'vip-inactive'}}">
    <view class="vip-content">
      <view class="vip-header">
        <t-icon name="user-vip" size="40rpx" color="#ffffff" />
        <text class="vip-title">{{pageText.vipMember}}</text>
      </view>
      <text class="vip-desc">{{isVip ? pageText.vipActiveDesc : pageText.vipInactiveDesc}}</text>
    </view>
    <view class="vip-status" bindtap="handleVipTap">
      <text class="status-text">{{isVip ? pageText.vipActivated : pageText.vipNotActivated}}</text>
    </view>
  </view>

  <!-- 统计卡片 -->
  <view class="data-cards">
    <view class="data-card" bindtap="goToTestResults">
      <text class="card-number {{!mbti ? 'empty-data' : ''}}">{{mbti || pageText.notTested}}</text>
      <text class="card-label">{{pageText.personalityType}}</text>
    </view>
    <view class="data-card" bindtap="goToFavorites">
      <text class="card-number {{favoritesCount === 0 ? 'empty-data' : ''}}">{{favoritesCount || pageText.noFavorites}}</text>
      <text class="card-label">{{pageText.favorites}}</text>
    </view>
  </view>

  <!-- 信息卡片 -->
  <view class="info-list">
    <view class="info-item gender-item" data-gender="{{gender}}">
      <t-icon name="{{gender === 'male' ? 'gender-male' : 'gender-female'}}" size="36rpx" color="{{gender === 'male' ? '#3b82f6' : '#ec4899'}}" class="info-icon gender-icon" />
      <view class="info-content">
        <text class="info-label">{{pageText.genderTitle}}</text>
        <text class="info-value gender-value">{{genderText}}</text>
      </view>
      <text class="switch-text gender-switch" bindtap="switchGender">{{pageText.switch}}</text>
    </view>
    
    <view class="info-item">
      <t-icon name="user-1" size="36rpx" color="#4c6ef5" class="info-icon" />
      <view class="info-content">
        <text class="info-label" wx:if="{{!editingNickname}}">{{pageText.wechatNickname}}</text>
        <!-- 显示模式 -->
        <text class="info-value {{!nickname ? 'empty-data' : ''}}" wx:if="{{!editingNickname}}">{{nickname || pageText.nicknameNotSet}}</text>
        <!-- 编辑模式 -->
        <view class="edit-input-wrapper" wx:if="{{editingNickname}}">
          <input 
            class="edit-input" 
            type="text" 
            value="{{nicknameInput}}" 
            placeholder="{{pageText.nicknameNotSet}}"
            bindinput="onNicknameInput"
            focus="{{editingNickname}}"
            maxlength="20"
          />
          <view class="edit-actions">
            <view class="action-btn save-btn" bindtap="saveNickname">
              <text class="icon-text">✓</text>
            </view>
            <view class="action-btn cancel-btn" bindtap="cancelEditNickname">
              <text class="icon-text">✕</text>
            </view>
          </view>
        </view>
      </view>
      <text class="edit-text" wx:if="{{!editingNickname}}" bindtap="editNickname">{{pageText.edit}}</text>
    </view>
    
    <view class="info-item">
      <t-icon name="mobile" size="36rpx" color="#10b981" class="info-icon" />
      <view class="info-content">
        <text class="info-label" wx:if="{{!editingPhone}}">{{pageText.phoneNumber}}</text>
        <!-- 显示模式 -->
        <text class="info-value {{!phone ? 'empty-data' : ''}}" wx:if="{{!editingPhone}}">{{phone || pageText.phoneNotBound}}</text>
        <!-- 编辑模式 -->
        <view class="edit-input-wrapper" wx:if="{{editingPhone}}">
          <input 
            class="edit-input" 
            type="number" 
            value="{{phoneInput}}" 
            placeholder="{{pageText.phoneNotBound}}"
            bindinput="onPhoneInput"
            focus="{{editingPhone}}"
            maxlength="11"
          />
          <view class="edit-actions">
            <view class="action-btn save-btn" bindtap="savePhone">
              <text class="icon-text">✓</text>
            </view>
            <view class="action-btn cancel-btn" bindtap="cancelEditPhone">
              <text class="icon-text">✕</text>
            </view>
          </view>
        </view>
      </view>
      <text class="edit-text" wx:if="{{!editingPhone}}" bindtap="editPhone">{{pageText.bind}}</text>
    </view>
    
    <view class="info-item">
      <t-icon name="base-station" size="36rpx" color="#f59e0b" class="info-icon" />
      <view class="info-content">
        <text class="info-label">{{pageText.userId}}</text>
        <text class="info-value {{!userId ? 'empty-data' : ''}}">{{userId || pageText.noUserId}}</text>
      </view>
      <text class="copy-text" bindtap="copyUserId">{{pageText.copy}}</text>
    </view>
  </view>

  <!-- 退出登录 -->
  <view class="logout-section">
    <text class="logout-btn" bindtap="logout">{{pageText.logout}}</text>
  </view>

  <!-- GenderBox 组件 -->
  <GenderBox visible="{{showGenderPopup}}" 
             lang="{{lang}}"
             gender="{{gender}}"
             genderData="{{genderData}}"
             canClose="{{canCloseGenderBox}}"
             bind:close="closeGenderBox"
             bind:confirm="confirmGender" />

  <!-- 登录弹窗 -->
  <login-popup
    lang="{{lang}}"
    visible="{{showLoginPopup}}"
    bind:close="closeLoginBox"
    bind:login-success="onLoginSuccess"
    bind:login-fail="onLoginFail"
  />
</view>

